input {
  tcp {
    port => 5000
    codec => json_lines
    # Écoute les logs JSON entrants sur le port 5000 (port interne du conteneur)
  }
}

filter {
  # Parser le message JSON envoyé par votre application
  json {
    source => "message"
    # Extrait les champs comme "service", "status", "user", etc. du JSON
  }

  # Ajouter un timestamp si absent (pour Elasticsearch)
  if ![@timestamp] {
    mutate {
      add_field => { "@timestamp" => "%{+ISO8601}" }
    }
  }

  # Nettoyer les champs inutiles (optionnel)
  mutate {
    remove_field => ["message", "host", "path", "@version"]
  }
}

output {
  # Envoyer vers Elasticsearch
  elasticsearch {
    hosts => ["elasticsearch:9200"]  # Host du conteneur Elasticsearch
    index => "transcendence-logs-%{+YYYY.MM.dd}"  # Index quotidien (correspond à votre init-kibana.sh)
    document_type => "_doc"
  }

  # Debug : Afficher dans la console Logstash (à retirer en prod)
  stdout {
    codec => rubydebug
  }
}